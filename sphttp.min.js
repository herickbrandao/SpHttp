/** SPHTTP 1.0.3 - https://github.com/herickbrandao/SpHttp */
var sphttp={baseURL:"../",cleanResponse:!0,digest:null,headers:{Accept:"application/json; odata=verbose"},_headers:{},timeout:15e3,top:5e3,version:"1.0.3",async items(e,t={}){if(!e)return this._error("Your object has not a list name",t);let s=t.ID||t.Id||!1,a=t.top||this.top||5e3;var r="_api/lists/getbytitle('"+e+"')/items",i="?";return(await this._verifyDigest(),this._headers=Object.assign({Accept:"application/json; odata=verbose","Content-Type":"application/json;odata=verbose","X-RequestDigest":this.digest},this.headers),t.select||(t.select=[]),t.expand||(t.expand=[]),"object"==typeof t.select&&(t.select=t.select.join()),"object"==typeof t.expand&&(t.expand=t.expand.join()),s)?(r+="("+s+")",t.versions&&(r+="/versions"),t.select?.length&&(r+=i+"$select="+t.select,i="&"),t.expand?.length>0&&(r+=i+"$expand="+t.expand,i="&"),t.avoidcache&&(r+=i+"$v="+window.crypto.randomUUID(),i="&"),this._rest(r,{},{select:t.select.split(",")})):(r+=i+"$top="+a,i="&",t.select?.length&&(r+=i+"$select="+t.select),t.expand?.length&&(r+=i+"$expand="+t.expand),t.filter?.length&&(r+=i+"$filter="+t.filter),t.avoidcache&&(r+=i+"$v="+window.crypto.randomUUID()),t.recursive)?this._recursive(this.baseURL+r,t):(t.orderby?.length&&(r+=i+"$orderby="+t.orderby),this._rest(r,{},{select:t.select.split(",")}))},async add(e,t){return await this._verifyDigest(),this._headers=Object.assign({Accept:"application/json; odata=nometadata","Content-Type":"application/json;odata=nometadata","X-RequestDigest":this.digest},this.headers),this._rest("_api/lists/getbytitle('"+e+"')/items",{method:"POST",body:"object"==typeof t?JSON.stringify(t):t})},async update(e,t){await this._verifyDigest(),this._headers=Object.assign({Accept:"application/json; odata=nometadata","Content-Type":"application/json;odata=nometadata","X-RequestDigest":this.digest,"IF-MATCH":"*","X-HTTP-Method":"MERGE"},this.headers);var s="_api/lists/getbytitle('"+e+"')/items",a=t.ID||t.Id||null;if("object"==typeof t&&a)s+="("+a+")";else throw"[ERROR] Put request data is wrong!";return this._rest(s,{method:"POST",body:"object"==typeof t?JSON.stringify(t):t})},async recycle(e,t){await this._verifyDigest(),this._headers=Object.assign({Accept:"application/json; odata=nometadata","Content-Type":"application/json;odata=nometadata","X-RequestDigest":this.digest},this.headers);var s="_api/lists/getbytitle('"+e+"')/items",a=t.ID||t.Id||null;if("object"==typeof t&&a)s+="("+a+")/recycle()";else if("number"==typeof t)s+="("+t+")/recycle()";else throw"[SPHTTP] Recycle request data is wrong!";return this._rest(s,{method:"POST",body:"object"==typeof t?JSON.stringify(t):t})},async delete(e,t){await this._verifyDigest(),this._headers=Object.assign({Accept:"application/json; odata=nometadata","Content-Type":"application/json;odata=nometadata","X-RequestDigest":this.digest,"IF-MATCH":"*","X-HTTP-Method":"DELETE"},this.headers);var s="_api/lists/getbytitle('"+e+"')/items",a=t.ID||t.Id||null;if("object"==typeof t&&a)s+="("+a+")";else if("number"==typeof t)s+="("+t+")";else throw"[SPHTTP] Delete request data is wrong!";return this._rest(s,{method:"POST"})},async attach(e,t={}){await this._verifyDigest(),this._headers=Object.assign({"X-RequestDigest":this.digest},this.headers);var s=t.ID||t.Id||("number"==typeof t?t:null)||null;if(!window.FileReader)throw"[SPHTTP] Your browser does not have support for FileReader!";if(isNaN(parseInt(s)))throw"[SPHTTP] List ID not found at attach request!";if(!t.target&&!t.delete)return this._rest("_api/lists/getbytitle('"+e+"')/items("+s+")/AttachmentFiles");if(t.delete)return this._headers=Object.assign({"X-HTTP-Method":"DELETE"},this._headers),url="_api/lists/GetByTitle('"+e+"')/items("+s+")/AttachmentFiles/getByFileName('"+t.delete+"')",this._rest(url,{method:"DELETE"});var a=!!("string"==typeof t.target&&document.querySelector(t.target))&&document.querySelector(t.target).files,r=this,i=[];for(var n in a)"object"==typeof a[n]&&i.push(this._getFileBuffer(a[n]));return Promise.all(i).then(async function(t){var i=[],n="";for(var o in t){r._headers=Object.assign({"X-RequestDigest":r.digest,"content-length":t[o].byteLength},r.headers),new Uint8Array(t[o]);var h=await r._rest(n="_api/lists/GetByTitle('"+e+"')/items("+s+")/AttachmentFiles/add(FileName='"+a[o].name+"')",{method:"POST",body:t[o]});i.push(h)}for(let l in i)i[l]&&i[l].d&&(i[l]=i[l].d);return i})},async attachDoc(e={}){if(await this._verifyDigest(),this._headers=Object.assign({"X-RequestDigest":this.digest},this.headers),!window.FileReader)throw"[SPHTTP] Your browser does not have support for FileReader!";if(!e.target&&!e.delete)return e.startswith&&e.name&&(e.tname="?$filter=startswith(Name,'"+e.name+"')"),this._rest("_api/web/GetFolderByServerRelativeUrl('"+e.library+"')/Files"+e.tname);if(e.delete)return this._headers=Object.assign({"X-HTTP-Method":"DELETE"},this._headers),url="_api/web/getfilebyserverrelativeurl('"+e.library+"/"+e.delete+"')",e.recycle&&!0==e.recycle&&(url+="/recycle()"),this._rest(url,{method:"POST"});var t=!!("string"==typeof e.target&&document.querySelector(e.target))&&document.querySelector(e.target).files,s=this,a=[];for(var r in t)"object"==typeof t[r]&&a.push(this._getFileBuffer(t[r]));return Promise.all(a).then(async function(a){var r=[],i="";for(var n in a){s._headers=Object.assign({"content-length":a[n].byteLength},s._headers),new Uint8Array(a[n]);var o,h=await s._rest(i="_api/web/GetFolderByServerRelativeUrl('"+e.library+"')/Files/Add(url='"+(e.name?e.name:t[n].name)+"', overwrite=true)",{method:"POST",body:a[n]});r.push(h)}for(let l in r)r[l]&&r[l].d&&(r[l]=r[l].d);return r})},async user(e=!1){switch(await this._verifyDigest(),this._headers=Object.assign({Accept:"application/json; odata=verbose","Content-Type":"application/json;odata=verbose","X-RequestDigest":this.digest},this.headers),typeof e){case"string":var t=[e.toLowerCase(),e.toUpperCase(),];let s=t[0],a=s.split(" ");for(var r=0;r<a.length;r++)a[r]=a[r].charAt(0).toUpperCase()+a[r].slice(1);t[2]=a.join(" "),t[3]=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"");var i="_api/web/siteusers?$filter=(";return i+="(startswith(Title,'"+t[0]+"')) or ",i+="(startswith(Title,'"+t[1]+"')) or ",i+="(startswith(Title,'"+t[3]+"')) or ",i+="(startswith(Title,'"+t[2]+"')))",this._rest(i);case"number":return this._rest("_api/Web/SiteUserInfoList/Items("+e+")");case"object":if(e.ID)return this._rest("_api/web/GetUserById("+e.ID+")/Groups");break;case"boolean":return this._rest("_api/Web/CurrentUser?$expand=groups")}throw"[SPHTTP] User Request Failed!"},async batch(e){await this._verifyDigest();var t=window.crypto.randomUUID(),s=window.crypto.randomUUID(),a=[],r=[],i=[];for(var n in e)e[n].action=e[n].action?.toUpperCase()||"GET","GET"==e[n].action?i.push(e[n]):r.push(e[n]);if(r.length){for(var n in a.push("--batch_"+t),a.push(`Content-Type: multipart/mixed; boundary="changeset_${s}"`),a.push("Content-Transfer-Encoding: binary"),a.push(""),r)switch(a.push("--changeset_"+s),a.push("Content-Type: application/http"),a.push("Content-Transfer-Encoding: binary"),a.push(""),r[n].action){case"UPDATE":a.push("PATCH "+r[n].url+" HTTP/1.1"),a.push("If-Match: *"),a.push("Content-Type: application/json;odata=verbose"),a.push(""),a.push(JSON.stringify(r[n].item||{})),a.push("");break;case"DELETE":a.push("DELETE "+r[n].url+" HTTP/1.1"),a.push("If-Match: *"),a.push("");break;case"POST":a.push("POST "+r[n].url+" HTTP/1.1"),a.push("Content-Type: application/json;odata=verbose"),a.push(""),r[n].item&&(a.push(JSON.stringify(r[n].item||{})),a.push(""))}a.push("--changeset_"+s+"--")}for(var n in i)a.push("--batch_"+t),a.push("Content-Type: application/http"),a.push("Content-Transfer-Encoding: binary"),a.push(""),a.push("GET "+i[n].url+" HTTP/1.1"),a.push("Accept: application/json;odata=verbose"),a.push("");a.push("--batch_"+t+"--");let o=a.join("\r\n");var h={"X-RequestDigest":this.digest,"Content-Type":`multipart/mixed; boundary="batch_${t}"`};return this._fetch(this.baseURL+"_api/$batch",{method:"POST",headers:h,credentials:"include",body:o}).then(function(e){if("string"!=typeof e)return{ok:!1,data:e};var t=[],s="",a=e.split("\r\n\r\n");for(var r of a)if(r.indexOf("No Content")>-1)0===r.indexOf("HTTP")&&r.indexOf("204")>-1?t.push({ok:!0,data:!0}):t.push({ok:!1,data:!1});else if(0===r.indexOf("<")){var s={};try{r.indexOf("<m:error")>-1?(r=r.split("<m:message")[1].split(">")[1].split("</m:message")[0],s={ok:!1,data:r}):s={ok:!0,data:r.split(">\r\n")[0]+">"}}catch(i){s={ok:!1,data:r}}t.push(s)}else if(0===r.indexOf("{")){try{s=JSON.parse(r.split("}\r\n")[0]+"}"),s={ok:!0,data:s}}catch(n){s={ok:!1,data:r}}t.push(s)}return t})},async _verifyDigest(e=!1){if(document.querySelector("#__REQUESTDIGEST")&&document.querySelector("#__REQUESTDIGEST").value&&!e)this.digest=document.querySelector("#__REQUESTDIGEST").value;else if(e||!this.digest){let t=this;return this._rest("_api/contextinfo",{method:"POST"}).then(function(e){return t.digest=e?.GetContextWebInformation?.FormDigestValue||"",e}).catch(function(e){return t._error(e),e})}return this.digest},async rest(e,t={},s={}){return await this._verifyDigest(),this._headers=Object.assign({Accept:"application/json; odata=verbose","Content-Type":"application/json;odata=verbose","X-RequestDigest":this.digest},this.headers),this._rest(e,t,s)},_rest(e,t={},s={}){let a=this;var r=a.baseURL+e;return a._fetch(r,t).then(function(e){return e?.d?.results?e.d.results.map(function(e){return a._cleanObj(e,s.select||[])}):e?.d?a._cleanObj(e.d,s.select||[]):e})},async _fetch(e,t){let s=this,a=new AbortController,r=setTimeout(function(){return a.abort()},s.timeout),i=await fetch(e,Object.assign({signal:a.signal,headers:s._headers},t)).then(async function(e){var a=!1;try{a=await e.text()}catch(r){if(e.status>199&&e.status<300)return!0;return!1}try{return JSON.parse(a)}catch(i){if(e.status>199&&e.status<300)return!a?.length||a;return s._error("[SPHTTP] Internal error - The response was not a JSON.",[e,t]),!1}}).then(function(e){if(e&&e["odata.error"]&&e["odata.error"]?.message?.value)throw e["odata.error"].message.value;if(e?.error?.message?.value)throw e.error.message.value;return t?.method==="POST"&&e?.d?.Id?e.d:e});return clearTimeout(r),i},_cleanObj(e,t=[]){if(this.cleanResponse&&t.length&&""!=t[0]){var s={};if(t.join().length>0)for(var a in t)e[t[a]]?s[t[a]]=e[t[a]]:e[t[a].split("/")[0]]?(s[t[a].split("/")[0]]||(s[t[a].split("/")[0]]=[]),e[t[a].split("/")[0]].results&&!s[t[a].split("/")[0]].length?s[t[a].split("/")[0]].push.apply(s[t[a].split("/")[0]],e[t[a].split("/")[0]].results):e[t[a].split("/")[0]]&&e[t[a].split("/")[0]][t[a].split("/")[1]]&&(s[t[a].split("/")[0]][0]=e[t[a].split("/")[0]])):s[t[a]]="object"==typeof s[t[a]]?null:s[t[a]];return s}return e},_reset(){this.baseURL="../",this.cleanResponse=!0,this.digest=null,this.headers={Accept:"application/json; odata=verbose"},this._headers={},this.timeout=15e3,this.top=5e3},_error:(e,t={})=>(console.error(e,t),e),_getFileBuffer:e=>new Promise(function(t,s){try{var a=new FileReader;a.onload=function(e){t(e.target.result)},a.onerror=function(e){s(e.target.error)},a.readAsArrayBuffer(e)}catch(r){console.error("[ERROR] "+r),s(r)}}),_recursive(e,t={}){let s=this;return new Promise(function(a,r){var i=[],n=async function(e){s._fetch(e).then(async function(e){e?.d?.results?i.push.apply(i,e.d.results.map(function(e){return s._cleanObj(e,t.select.split(","))})):e?.d&&i.push.apply(i,s._cleanObj(e.d,t.select.split(","))),e?.d?.__next?await n(e.d.__next):a(i)}).catch(function(e){r(e)})};n(e)})}};