/** SPHTTP 1.0.2 - https://github.com/herickbrandao/SpHttp */
var sphttp={baseURL:"../",cleanResponse:!0,digest:null,headers:{Accept:"application/json; odata=verbose"},_headers:{},timeout:15e3,top:5e3,version:"1.0.2",async items(e,t={}){if(!e)return this._error("Your object has not a list name",t);let s=t.ID||t.Id||!1,r=t.top||this.top||5e3;var a="_api/lists/getbytitle('"+e+"')/items",i="?";return(await this._verifyDigest(),this._headers=Object.assign({Accept:"application/json; odata=verbose","Content-Type":"application/json;odata=verbose","X-RequestDigest":this.digest},this.headers),t.select||(t.select=[]),t.expand||(t.expand=[]),"object"==typeof t.select&&(t.select=t.select.join()),"object"==typeof t.expand&&(t.expand=t.expand.join()),s)?(a+="("+s+")",t.versions&&(a+="/versions"),t.select?.length&&(a+=i+"$select="+t.select,i="&"),t.expand?.length>0&&(a+=i+"$expand="+t.expand,i="&"),t.avoidcache&&(a+=i+"$v="+window.crypto.randomUUID(),i="&"),this._rest(a,{},{select:t.select.split(",")})):(a+=i+"$top="+r,i="&",t.select?.length&&(a+=i+"$select="+t.select),t.expand?.length&&(a+=i+"$expand="+t.expand),t.filter?.length&&(a+=i+"$filter="+t.filter),t.avoidcache&&(a+=i+"$v="+window.crypto.randomUUID()),t.recursive)?this._recursive(this.baseURL+a,t):(t.orderby?.length&&(a+=i+"$orderby="+t.orderby),this._rest(a,{},{select:t.select.split(",")}))},async add(e,t){return await this._verifyDigest(),this._headers=Object.assign({Accept:"application/json; odata=nometadata","Content-Type":"application/json;odata=nometadata","X-RequestDigest":this.digest},this.headers),this._rest("_api/lists/getbytitle('"+e+"')/items",{method:"POST",body:"object"==typeof t?JSON.stringify(t):t})},async update(e,t){await this._verifyDigest(),this._headers=Object.assign({Accept:"application/json; odata=nometadata","Content-Type":"application/json;odata=nometadata","X-RequestDigest":this.digest,"IF-MATCH":"*","X-HTTP-Method":"MERGE"},this.headers);var s="_api/lists/getbytitle('"+e+"')/items",r=t.ID||t.Id||null;if("object"==typeof t&&r)s+="("+r+")";else throw"[ERROR] Put request data is wrong!";return this._rest(s,{method:"POST",body:"object"==typeof t?JSON.stringify(t):t})},async recycle(e,t){await this._verifyDigest(),this._headers=Object.assign({Accept:"application/json; odata=nometadata","Content-Type":"application/json;odata=nometadata","X-RequestDigest":this.digest},this.headers);var s="_api/lists/getbytitle('"+e+"')/items",r=t.ID||t.Id||null;if("object"==typeof t&&r)s+="("+r+")/recycle()";else if("number"==typeof t)s+="("+t+")/recycle()";else throw"[SPHTTP] Recycle request data is wrong!";return this._rest(s,{method:"POST",body:"object"==typeof t?JSON.stringify(t):t})},async delete(e,t){await this._verifyDigest(),this._headers=Object.assign({Accept:"application/json; odata=nometadata","Content-Type":"application/json;odata=nometadata","X-RequestDigest":this.digest,"IF-MATCH":"*","X-HTTP-Method":"DELETE"},this.headers);var s="_api/lists/getbytitle('"+e+"')/items",r=t.ID||t.Id||null;if("object"==typeof t&&r)s+="("+r+")";else if("number"==typeof t)s+="("+t+")";else throw"[SPHTTP] Delete request data is wrong!";return this._rest(s,{method:"POST"})},async attach(e,t={}){await this._verifyDigest(),this._headers=Object.assign({"X-RequestDigest":this.digest},this.headers);var s=t.ID||t.Id||("number"==typeof t?t:null)||null;if(!window.FileReader)throw"[SPHTTP] Your browser does not have support for FileReader!";if(isNaN(parseInt(s)))throw"[SPHTTP] List ID not found at attach request!";if(!t.target&&!t.delete)return this._rest("_api/lists/getbytitle('"+e+"')/items("+s+")/AttachmentFiles");if(t.delete)return this._headers=Object.assign({"X-HTTP-Method":"DELETE"},this._headers),url="_api/lists/GetByTitle('"+e+"')/items("+s+")/AttachmentFiles/getByFileName('"+t.delete+"')",this._rest(url,{method:"DELETE"});var r=!!("string"==typeof t.target&&document.querySelector(t.target))&&document.querySelector(t.target).files,a=[];for(var i in r)"object"==typeof r[i]&&a.push(this._getFileBuffer(r[i]));return Promise.all(a).then(function(e){var t=[],a="";for(var i in e)this._headers=Object.assign({"X-RequestDigest":this.digest,"content-length":e[i].byteLength},this.headers),new Uint8Array(e[i]),a="_api/lists/GetByTitle('"+listName+"')/items("+s+")/AttachmentFiles/add(FileName='"+r[i].name+"')",t.push(this._fetch(a,{method:"POST",body:e[i]}));return Promise.all(t).then(function(e){for(var t in e)e[t]&&e[t].d&&(e[t]=e[t].d);return e})})},async attachDoc(e={}){if(await this._verifyDigest(),this._headers=Object.assign({"X-RequestDigest":this.digest},this.headers),!window.FileReader)throw"[SPHTTP] Your browser does not have support for FileReader!";if(!e.target&&!e.delete)return e.startswith&&e.name&&(e.tname="?$filter=startswith(Name,'"+e.name+"')"),this._rest("_api/web/GetFolderByServerRelativeUrl('"+e.library+"')/Files"+e.tname);if(e.delete)return this._headers=Object.assign({"X-HTTP-Method":"DELETE"},this._headers),url="_api/web/getfilebyserverrelativeurl('"+e.library+"/"+e.delete+"')",e.recycle&&!0==e.recycle&&(url+="/recycle()"),this._rest(url,{method:"POST"});var t=!!("string"==typeof e.target&&document.querySelector(e.target))&&document.querySelector(e.target).files,s=[];for(var r in t)"object"==typeof t[r]&&s.push(this._getFileBuffer(t[r]));return Promise.all(s).then(function(s){var r=[],a="";for(var i in s){this._headers=Object.assign({"content-length":s[i].byteLength},this._headers),new Uint8Array(s[i]);var n=e.name?e.name:t[i].name;a="_api/web/GetFolderByServerRelativeUrl('"+e.library+"')/Files/Add(url='"+n+"', overwrite=true)",r.push(this._rest(a,{method:"POST",body:s[i]}))}return Promise.all(r).then(function(e){for(var t in e)e[t]&&e[t].d&&(e[t]=e[t].d);return e})})},async user(e=!1){switch(await this._verifyDigest(),this._headers=Object.assign({Accept:"application/json; odata=verbose","Content-Type":"application/json;odata=verbose","X-RequestDigest":this.digest},this.headers),typeof e){case"string":var t=[e.toLowerCase(),e.toUpperCase(),];let s=t[0],r=s.split(" ");for(var a=0;a<r.length;a++)r[a]=r[a].charAt(0).toUpperCase()+r[a].slice(1);t[2]=r.join(" "),t[3]=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"");var i="_api/web/siteusers?$filter=(";return i+="(startswith(Title,'"+t[0]+"')) or ",i+="(startswith(Title,'"+t[1]+"')) or ",i+="(startswith(Title,'"+t[3]+"')) or ",i+="(startswith(Title,'"+t[2]+"')))",this._rest(i);case"number":return this._rest("_api/Web/SiteUserInfoList/Items("+e+")");case"object":if(e.ID)return this._rest("_api/web/GetUserById("+e.ID+")/Groups");break;case"boolean":return this._rest("_api/Web/CurrentUser?$expand=groups")}throw"[SPHTTP] User Request Failed!"},async batch(e){await this._verifyDigest();var t=window.crypto.randomUUID(),s=window.crypto.randomUUID(),r=[],a=[],i=[];for(var n in e)e[n].action=e[n].action?.toUpperCase()||"GET","GET"==e[n].action?i.push(e[n]):a.push(e[n]);if(a.length){for(var n in r.push("--batch_"+t),r.push(`Content-Type: multipart/mixed; boundary="changeset_${s}"`),r.push("Content-Transfer-Encoding: binary"),r.push(""),a)switch(r.push("--changeset_"+s),r.push("Content-Type: application/http"),r.push("Content-Transfer-Encoding: binary"),r.push(""),a[n].action){case"UPDATE":r.push("PATCH "+a[n].url+" HTTP/1.1"),r.push("If-Match: *"),r.push("Content-Type: application/json;odata=verbose"),r.push(""),r.push(JSON.stringify(a[n].item||{})),r.push("");break;case"DELETE":r.push("DELETE "+a[n].url+" HTTP/1.1"),r.push("If-Match: *"),r.push("");break;case"POST":r.push("POST "+a[n].url+" HTTP/1.1"),r.push("Content-Type: application/json;odata=verbose"),r.push(""),a[n].item&&(r.push(JSON.stringify(a[n].item||{})),r.push(""))}r.push("--changeset_"+s+"--")}for(var n in i)r.push("--batch_"+t),r.push("Content-Type: application/http"),r.push("Content-Transfer-Encoding: binary"),r.push(""),r.push("GET "+i[n].url+" HTTP/1.1"),r.push("Accept: application/json;odata=verbose"),r.push("");r.push("--batch_"+t+"--");let o=r.join("\r\n");var h={"X-RequestDigest":this.digest,"Content-Type":`multipart/mixed; boundary="batch_${t}"`};return this._fetch(this.baseURL+"_api/$batch",{method:"POST",headers:h,credentials:"include",body:o}).then(function(e){if("string"!=typeof e)return{ok:!1,data:e};var t=[],s="",r=e.split("\r\n\r\n");for(var a of r)if(a.indexOf("No Content")>-1)0===a.indexOf("HTTP")&&a.indexOf("204")>-1?t.push({ok:!0,data:!0}):t.push({ok:!1,data:!1});else if(0===a.indexOf("<")){var s={};try{a.indexOf("<m:error")>-1?(a=a.split("<m:message")[1].split(">")[1].split("</m:message")[0],s={ok:!1,data:a}):s={ok:!0,data:a.split(">\r\n")[0]+">"}}catch(i){s={ok:!1,data:a}}t.push(s)}else if(0===a.indexOf("{")){try{s=JSON.parse(a.split("}\r\n")[0]+"}"),s={ok:!0,data:s}}catch(n){s={ok:!1,data:a}}t.push(s)}return t})},async _verifyDigest(e=!1){if(document.querySelector("#__REQUESTDIGEST")&&document.querySelector("#__REQUESTDIGEST").value&&!e)this.digest=document.querySelector("#__REQUESTDIGEST").value;else if(e||!this.digest){let t=this;return this._rest("_api/contextinfo",{method:"POST"}).then(function(e){return t.digest=e?.GetContextWebInformation?.FormDigestValue||"",e}).catch(function(e){return t._error(e),e})}return this.digest},async rest(e,t={},s={}){return await this._verifyDigest(),this._headers=Object.assign({Accept:"application/json; odata=verbose","Content-Type":"application/json;odata=verbose","X-RequestDigest":this.digest},this.headers),this._rest(e,t,s)},_rest(e,t={},s={}){let r=this;var a=r.baseURL+e;return r._fetch(a,t).then(function(e){return e?.d?.results?e.d.results.map(function(e){return r._cleanObj(e,s.select||[])}):e?.d?r._cleanObj(e.d,s.select||[]):e})},async _fetch(e,t){let s=this,r=new AbortController,a=setTimeout(function(){return r.abort()},s.timeout),i=await fetch(e,Object.assign({signal:r.signal,headers:s._headers},t)).then(async function(e){var r=!1;try{r=await e.text()}catch(a){if(e.status>199&&e.status<300)return!0;return!1}try{return JSON.parse(r)}catch(i){if(e.status>199&&e.status<300)return!r?.length||r;return s._error("[SPHTTP] Internal error - The response was not a JSON.",[e,t]),!1}}).then(function(e){if(e&&e["odata.error"]&&e["odata.error"]?.message?.value)throw e["odata.error"].message.value;if(e?.error?.message?.value)throw e.error.message.value;return t?.method==="POST"&&e?.d?.Id?e.d:e});return clearTimeout(a),i},_cleanObj(e,t=[]){if(this.cleanResponse&&t.length&&""!=t[0]){var s={};if(t.join().length>0)for(var r in t)e[t[r]]?s[t[r]]=e[t[r]]:e[t[r].split("/")[0]]?(s[t[r].split("/")[0]]||(s[t[r].split("/")[0]]=[]),e[t[r].split("/")[0]].results&&!s[t[r].split("/")[0]].length?s[t[r].split("/")[0]].push.apply(s[t[r].split("/")[0]],e[t[r].split("/")[0]].results):e[t[r].split("/")[0]]&&e[t[r].split("/")[0]][t[r].split("/")[1]]&&(s[t[r].split("/")[0]][0]=e[t[r].split("/")[0]])):s[t[r]]="object"==typeof s[t[r]]?null:s[t[r]];return s}return e},_reset(){this.baseURL="../",this.cleanResponse=!0,this.digest=null,this.headers={Accept:"application/json; odata=verbose"},this._headers={},this.timeout=15e3,this.top=5e3},_error:(e,t={})=>(console.error(e,t),e),_getFileBuffer:e=>new Promise(function(t,s){try{var r=new FileReader;r.onload=function(e){t(e.target.result)},r.onerror=function(e){s(e.target.error)},r.readAsArrayBuffer(e)}catch(a){console.error("[ERROR] "+a),s(a)}}),_recursive(e,t={}){let s=this;return new Promise(function(r,a){var i=[],n=async function(e){s._fetch(e).then(async function(e){e?.d?.results?i.push.apply(i,e.d.results.map(function(e){return s._cleanObj(e,t.select.split(","))})):e?.d&&i.push.apply(i,s._cleanObj(e.d,t.select.split(","))),e?.d?.__next?await n(e.d.__next):r(i)}).catch(function(e){a(e)})};n(e)})}};